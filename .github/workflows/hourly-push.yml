name: Push Notifications (30/day)

on:
  schedule:
    # 30 notifications per day from 8 AM to 1 AM IST (next day)
    # IST = UTC + 5:30, so 8 AM IST = 2:30 UTC, 1 AM IST = 19:30 UTC
    # 17 hours = 1020 min / 30 = every ~34 min
    - cron: "30 2 * * *" # 08:00 IST
    - cron: "4 3 * * *" # 08:34 IST
    - cron: "38 3 * * *" # 09:08 IST
    - cron: "12 4 * * *" # 09:42 IST
    - cron: "46 4 * * *" # 10:16 IST
    - cron: "20 5 * * *" # 10:50 IST
    - cron: "54 5 * * *" # 11:24 IST
    - cron: "28 6 * * *" # 11:58 IST
    - cron: "2 7 * * *" # 12:32 IST
    - cron: "36 7 * * *" # 13:06 IST
    - cron: "10 8 * * *" # 13:40 IST
    - cron: "44 8 * * *" # 14:14 IST
    - cron: "18 9 * * *" # 14:48 IST
    - cron: "52 9 * * *" # 15:22 IST
    - cron: "26 10 * * *" # 15:56 IST
    - cron: "0 11 * * *" # 16:30 IST
    - cron: "34 11 * * *" # 17:04 IST
    - cron: "8 12 * * *" # 17:38 IST
    - cron: "42 12 * * *" # 18:12 IST
    - cron: "16 13 * * *" # 18:46 IST
    - cron: "50 13 * * *" # 19:20 IST
    - cron: "24 14 * * *" # 19:54 IST
    - cron: "58 14 * * *" # 20:28 IST
    - cron: "32 15 * * *" # 21:02 IST
    - cron: "6 16 * * *" # 21:36 IST
    - cron: "40 16 * * *" # 22:10 IST
    - cron: "14 17 * * *" # 22:44 IST
    - cron: "48 17 * * *" # 23:18 IST
    - cron: "22 18 * * *" # 23:52 IST
    - cron: "56 18 * * *" # 00:26 IST (next day)
  workflow_dispatch: # Allow manual trigger for testing

jobs:
  send-push:
    runs-on: ubuntu-latest
    steps:
      - name: Send Hourly Push Notification
        env:
          TZ: Asia/Kolkata
        run: |
          response=$(curl -s -w "\n%{http_code}" \
            --location '${{ secrets.API_URL }}/api/cron/send-daily-push' \
            --header 'Authorization: Bearer ${{ secrets.CRON_SECRET }}' \
            --header 'Cache-Control: no-cache')

          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')

          echo "Response: $body"
          echo "HTTP Code: $http_code"

          if [ "$http_code" -ge 200 ] && [ "$http_code" -lt 300 ]; then
            echo "✅ Push notification sent successfully"
          else
            echo "❌ Failed to send push notification"
            exit 1
          fi
